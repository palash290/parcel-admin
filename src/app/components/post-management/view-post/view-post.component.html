<div class="ct_px_30 ct_mt_30 pb-4">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="d-flex align-items-center gap-3 justify-content-between ct_flex_col_575 mb-4">
                    <h4 class="d-flex align-items-center gap-2 ct_fw_600 ct_text_061F61 mb-0 ct_fs_24"><a
                            routerLink="/home/post-namagement" class="ct_black_text"><i
                                class="fa-solid fa-angle-left"></i></a>Post Details</h4>
                    <button class="ct_outline_btn ct_border_radius_5 ct_w_100_575" data-bs-toggle="modal"
                        data-bs-target="#ct_delete_modal">Delete Post</button>
                </div>


                <div class="ct_white_bg ct_box_shadow p-4 h-auto">
                    <div class="d-flex align-items-center gap-3 mb-3">
                        <img [src]="postData?.agent.profile_image ? postData?.agent.profile_image : 'img/np_pro.png'"
                            alt="" class="ct_img_40 ct_cursor_pointer" data-bs-toggle="modal"
                            data-bs-target="#full_view_img">
                        <div>
                            <h5 class="ct_fs_18 ct_fw_600 mb-0 ct_text_061F61">{{postData?.agent.full_name}}</h5>
                            <!-- <p class="mb-0 ct_text_666 ct_fw_600 ct_fs_14">Augusta National</p> -->
                        </div>
                    </div>

                    <div class="ct_post_slider_img mb-3">

                        <!-- Show VIDEO -->
                        <video *ngIf="postData?.media_type == 'VIDEO'" [src]="postData?.files"
                            [poster]="postData?.thumbnail" controls width="100%" height="400px">
                        </video>

                        <!-- 🖼️ MULTIPLE IMAGES -->
                        <div *ngIf="postData?.media_type === 'IMAGE' && postData?.files?.length > 0">
                            <div class="swiper mySwiperMain ct_product_slider_12">
                                <div class="swiper-wrapper">
                                    <div class="swiper-slide" *ngFor="let img of postData?.files">
                                        <img [src]="img" />
                                    </div>
                                </div>
                                @if(images.length > 1){
                                <div class="swiper-button-next"></div>
                                <div class="swiper-button-prev"></div>
                                }

                                @if(images.length > 1){
                                <div class="swiper mySwiperThumbs ct_card_small_thumb mt-3">
                                    <div class="swiper-wrapper">
                                        <div class="swiper-slide" *ngFor="let img of postData.images">
                                            <img [src]="img" />
                                        </div>
                                    </div>
                                </div>
                                }
                            </div>
                        </div>
                    </div>

                    <p class="ct_fs_18 mb-0">{{postData?.description}}</p>

                    <ul class="d-flex align-items-center gap-3 flex-wrap mt-3">
                        <li class="d-flex align-items-center gap-2">
                            <i class="fa-regular fa-heart"></i>
                            {{postData?.total_likes}}
                        </li>
                        <li (click)="toggleCmt(postData?.property_reel_id, '')" style="cursor: pointer;"
                            class="d-flex align-items-center gap-2">
                            <i class="fa-regular fa-comment"></i>
                            {{postData?.total_comments}}
                        </li>
                        <li class="d-flex align-items-center gap-2">
                            <i class="fa-regular fa-eye"></i>
                            {{postData?.total_views}}
                        </li>
                    </ul>
                    <!-- show this div when click on chat icon -->
                    <div class="ct_comment_area_main mt-4" *ngIf="showCmt">
                        <h4 class="ct_fs_20 ct_fw_600 mb-3">Comments</h4>

                        <div class="ct_comment_area_scroll">
                            <div class="ct_border_btm_1 mt-3 pb-3" *ngFor="let cmt of cmtData">
                                <div class="d-flex justify-content-between gap-2">
                                    <div class="d-flex gap-3">
                                        <img [src]="cmt.user?.profile_image || 'assets/img/default.png'" alt=""
                                            class="ct_img_40 ct_white_border_1" />
                                        <div style="flex: 1;">
                                            <div class="d-flex align-items-center gap-2 flex-wrap">
                                                <h5 class="ct_fs_16 ct_fw_600 mb-0">{{ cmt.user?.full_name }}</h5>
                                                <p class="mb-0 ct_fs_12 ct_text_op_5">{{ cmt.created_at | date:'short'
                                                    }}</p>
                                            </div>

                                            <p class="ct_fs_14 mb-0 mt-2">
                                                {{ cmt.body }}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- View Replies Toggle -->
                                <div class="ct_or_overlay_text" style="cursor: pointer;" *ngIf="cmt.itsHaveChildReplies"
                                    (click)="toggleReplies(cmt.comment_id, postId)">
                                    <p class="mb-0 text-center">
                                        {{ expandedComments[cmt.comment_id] ? 'Hide Replies' : 'View More Replies (' +
                                        cmt.replyCount + ')' }}
                                    </p>
                                </div>

                                <!-- Replies Section -->
                                <div class="ps-3" *ngIf="expandedComments[cmt.comment_id]">
                                    <ng-container *ngIf="replies[cmt.comment_id]?.length; else loadingReplies">
                                        <div class="d-flex gap-3 mt-3" *ngFor="let reply of replies[cmt.comment_id]">
                                            <img [src]="reply.user?.profile_image || 'assets/img/default.png'"
                                                class="ct_img_30 ct_white_border_1" />
                                            <div style="flex: 1;">
                                                <div class="d-flex align-items-center gap-2 flex-wrap">
                                                    <h5 class="ct_fs_14 ct_fw_600 mb-0">{{ reply.user?.full_name }}</h5>
                                                    <p class="mb-0 ct_fs_12 ct_text_op_5">{{ reply.created_at |
                                                        date:'short' }}</p>
                                                </div>
                                                <p class="ct_fs_12 mb-0 mt-2">{{ reply.body }}</p>
                                            </div>
                                        </div>
                                    </ng-container>

                                    <ng-template #loadingReplies>
                                        <p class="ct_fs_12 text-center text-muted mt-2">Loading replies...</p>
                                    </ng-template>
                                </div>
                            </div>
                            <div class="ct_fs_15 text-center text-muted mt-2" *ngIf="cmtData?.length == 0">
                                No Comments
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal S -->
<div class="modal fade modal-md" id="ct_delete_modal" tabindex="-1" aria-labelledby="ct_unlink_modalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-0">
                <!-- <h5 class="modal-title ct_fs_24 ct_ff_QuattrocentoSans ct_fw_700 mb-0"
                            id="ct_unlink_modalLabel">
                            Image Preview
                        </h5> -->
                <button type="button" class="btn-close ct_custom_close_img" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div class=" mx-auto mb-4">
                    <svg width="49" height="54" viewBox="0 0 49 54" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_1_8145)">
                            <mask id="mask0_1_8145" style="mask-type: luminance" maskUnits="userSpaceOnUse" x="0" y="3"
                                width="49" height="48">
                                <path d="M48.5 3H0.5V51H48.5V3Z" fill="white" />
                            </mask>
                            <g mask="url(#mask0_1_8145)">
                                <path
                                    d="M24.4972 7.03125C25.9072 7.09378 26.98 7.71878 27.7156 8.90625L47.5777 43.4062C48.1907 44.6562 48.1907 45.9062 47.5777 47.1562C46.8421 48.3438 45.7693 48.9688 44.3593 49.0312H4.63519C3.22523 48.9688 2.15243 48.3438 1.4168 47.1562C0.803775 45.9062 0.803775 44.6562 1.4168 43.4062L21.3708 8.90625C22.1064 7.71878 23.1486 7.09378 24.4972 7.03125ZM24.4972 19.0312C23.1486 19.1562 22.4129 19.9062 22.2903 21.2812V31.7812C22.4129 33.1562 23.1486 33.9062 24.4972 34.0312C25.8459 33.9062 26.5815 33.1562 26.7041 31.7812V21.2812C26.5815 19.9062 25.8459 19.1562 24.4972 19.0312ZM27.4398 40.0312C27.4398 39.1562 27.164 38.4375 26.6122 37.875C26.0605 37.3125 25.3555 37.0312 24.4972 37.0312C23.639 37.0312 22.9341 37.3125 22.3823 37.875C21.8306 38.4375 21.5547 39.1562 21.5547 40.0312C21.5547 40.9062 21.8306 41.625 22.3823 42.1875C22.9341 42.75 23.639 43.0312 24.4972 43.0312C25.3555 43.0312 26.0605 42.75 26.6122 42.1875C27.164 41.625 27.4398 40.9062 27.4398 40.0312Z"
                                    fill="#FF0000" />
                            </g>
                        </g>
                        <defs>
                            <clipPath id="clip0_1_8145">
                                <rect width="48" height="53.3335" fill="white" transform="translate(0.5 0.333984)" />
                            </clipPath>
                        </defs>
                    </svg>
                </div>
                <h4 class="ct_fs_20 ct_fw_600 ct_text_061F61">
                    Delete Post?
                </h4>
                <p class="mb-0  ct_text_666">Are you sure you want to delete this post? This action cannot be undone.
                </p>
                <div class="d-flex align-items-center gap-3 mt-4 justify-content-center">
                    <button class="ct_outline_btn px-5 py-2 w-100 ct_fw_600" data-bs-dismiss="modal">Cancel</button>
                    <button class="ct_dark_green_btn px-5 py-2 w-100 ct_fw_600" (click)="deletePost()">Yes</button>
                </div>
                <button hidden type="button" class="btn btn-secondary" #closeModalDelete
                    data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Delete Modal E -->

<div class="ct_loader_main" *ngIf="isLoading">
    <span class="loader"></span>
</div>